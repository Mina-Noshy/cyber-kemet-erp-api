{"Timestamp":"2024-03-26T23:31:47.3344053+02:00","Level":"Information","MessageTemplate":"Starting web host"}
{"Timestamp":"2024-03-26T23:31:51.3076768+02:00","Level":"Information","MessageTemplate":"Application started. Press Ctrl+C to shut down.","Properties":{"SourceContext":"Microsoft.Hosting.Lifetime"}}
{"Timestamp":"2024-03-26T23:31:51.3269374+02:00","Level":"Information","MessageTemplate":"Hosting environment: {EnvName}","Properties":{"EnvName":"Development","SourceContext":"Microsoft.Hosting.Lifetime"}}
{"Timestamp":"2024-03-26T23:31:51.3283776+02:00","Level":"Information","MessageTemplate":"Content root path: {ContentRoot}","Properties":{"ContentRoot":"C:\\Projects\\Web\\cyber-kemet-erp-api\\Kemet.ERP\\Kemet.ERP.Api","SourceContext":"Microsoft.Hosting.Lifetime"}}
{"Timestamp":"2024-03-26T23:34:45.7327262+02:00","Level":"Information","MessageTemplate":"Executed DbCommand ({elapsed}ms) [Parameters=[{parameters}], CommandType='{commandType}', CommandTimeout='{commandTimeout}']{newLine}{commandText}","TraceId":"79a47129a8775e249e3159de6ee3c635","SpanId":"bdaacbb056a0c35e","Properties":{"elapsed":"92","parameters":"@__normalizedUserName_0='?' (Size = 256)","commandType":"Text","commandTimeout":600,"newLine":"\r\n","commandText":"SELECT [t].[Id], [t].[AccessFailedCount], [t].[ConcurrencyStamp], [t].[Email], [t].[EmailConfirmed], [t].[FirstName], [t].[LastName], [t].[LockoutEnabled], [t].[LockoutEnd], [t].[NormalizedEmail], [t].[NormalizedUserName], [t].[PasswordHash], [t].[PhoneNumber], [t].[PhoneNumberConfirmed], [t].[SecurityStamp], [t].[TwoFactorEnabled], [t].[UserName], [r].[Id], [r].[AppUserId], [r].[CreatedOn], [r].[ExpiresOn], [r].[RevokedOn], [r].[Token]\r\nFROM (\r\n    SELECT TOP(1) [u].[Id], [u].[AccessFailedCount], [u].[ConcurrencyStamp], [u].[Email], [u].[EmailConfirmed], [u].[FirstName], [u].[LastName], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[PasswordHash], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[SecurityStamp], [u].[TwoFactorEnabled], [u].[UserName]\r\n    FROM [UserMaster] AS [u]\r\n    WHERE [u].[NormalizedUserName] = @__normalizedUserName_0\r\n) AS [t]\r\nLEFT JOIN [RefreshToken] AS [r] ON [t].[Id] = [r].[AppUserId]\r\nORDER BY [t].[Id]","EventId":{"Id":20101,"Name":"Microsoft.EntityFrameworkCore.Database.Command.CommandExecuted"},"SourceContext":"Microsoft.EntityFrameworkCore.Database.Command","ActionId":"ba6d47d2-a1aa-4ff3-8c97-329f2347c065","ActionName":"Kemet.ERP.Presentation.Controllers.HR.AccountsController.CreateUserAsync (Kemet.ERP.Presentation)","RequestId":"80000006-0002-f900-b63f-84710c7967bb","RequestPath":"/api/hr/accounts/create-user"}}
{"Timestamp":"2024-03-26T23:34:46.7966238+02:00","Level":"Error","MessageTemplate":"HTTP {RequestMethod} {RequestPath} responded {StatusCode} in {Elapsed:0.0000} ms","TraceId":"79a47129a8775e249e3159de6ee3c635","SpanId":"bdaacbb056a0c35e","Exception":"System.InvalidOperationException: Unable to track an entity of type 'AppUser' because its primary key property 'Id' is null.\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NullableKeyIdentityMap`1.Add(InternalEntityEntry entry)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.StartTracking(InternalEntityEntry entry)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityState(EntityState oldState, EntityState newState, Boolean acceptChanges, Boolean modifyProperties)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityState(EntityState entityState, Boolean acceptChanges, Boolean modifyProperties, Nullable`1 forceStateWhenUnknownKey, Nullable`1 fallbackState)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.PaintAction(EntityEntryGraphNode`1 node)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityEntryGraphIterator.TraverseGraph[TState](EntityEntryGraphNode`1 node, Func`2 handleNode)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.AttachGraph(InternalEntityEntry rootEntry, EntityState targetState, EntityState storeGeneratedWithKeySetTargetState, Boolean forceStateWhenUnknownKey)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SetEntityState(InternalEntityEntry entry, EntityState entityState)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SetEntityState[TEntity](TEntity entity, EntityState entityState)\r\n   at Microsoft.EntityFrameworkCore.DbContext.Add[TEntity](TEntity entity)\r\n   at Microsoft.AspNetCore.Identity.EntityFrameworkCore.UserStore`9.CreateAsync(TUser user, CancellationToken cancellationToken)\r\n   at Microsoft.AspNetCore.Identity.UserManager`1.CreateAsync(TUser user)\r\n   at Kemet.ERP.Persistence.Repositories.Entity.HR.AccountRepository.ConfigureAndCreateUser(AppUser user, String password, CancellationToken cancellationToken) in C:\\Projects\\Web\\cyber-kemet-erp-api\\Kemet.ERP\\Kemet.ERP.Persistence\\Repositories\\Entity\\HR\\AccountRepository.cs:line 47\r\n   at Kemet.ERP.Persistence.Repositories.Entity.HR.AccountRepository.CreateUserAsync(AppUser user, String password, CancellationToken cancellationToken) in C:\\Projects\\Web\\cyber-kemet-erp-api\\Kemet.ERP\\Kemet.ERP.Persistence\\Repositories\\Entity\\HR\\AccountRepository.cs:line 20\r\n   at Kemet.ERP.Services.Entity.HR.AccountService.CreateUserAsync(CreateUserDto request, CancellationToken cancellationToken) in C:\\Projects\\Web\\cyber-kemet-erp-api\\Kemet.ERP\\Kemet.ERP.Services\\Entity\\HR\\AccountService.cs:line 22\r\n   at Kemet.ERP.Presentation.Controllers.HR.AccountsController.CreateUserAsync(CreateUserDto request, CancellationToken cancellationToken) in C:\\Projects\\Web\\cyber-kemet-erp-api\\Kemet.ERP\\Kemet.ERP.Presentation\\Controllers\\HR\\AccountsController.cs:line 21\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)\r\n   at Kemet.ERP.Api.ManageExtensions.PiplineConfigurations.<>c.<<UseAppPipilines>b__0_0>d.MoveNext() in C:\\Projects\\Web\\cyber-kemet-erp-api\\Kemet.ERP\\Kemet.ERP.Api\\ManageExtensions\\PiplineConfigurations.cs:line 56\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)\r\n   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)\r\n   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)","Properties":{"RequestMethod":"POST","RequestPath":"/api/hr/accounts/create-user","StatusCode":500,"Elapsed":5870.3358,"SourceContext":"Serilog.AspNetCore.RequestLoggingMiddleware"},"Renderings":{"Elapsed":[{"Format":"0.0000","Rendering":"5870.3358"}]}}
{"Timestamp":"2024-03-26T23:34:47.4810037+02:00","Level":"Error","MessageTemplate":"Unable to track an entity of type 'AppUser' because its primary key property 'Id' is null.","TraceId":"79a47129a8775e249e3159de6ee3c635","SpanId":"bdaacbb056a0c35e","Exception":"System.InvalidOperationException: Unable to track an entity of type 'AppUser' because its primary key property 'Id' is null.\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NullableKeyIdentityMap`1.Add(InternalEntityEntry entry)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.StartTracking(InternalEntityEntry entry)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityState(EntityState oldState, EntityState newState, Boolean acceptChanges, Boolean modifyProperties)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityState(EntityState entityState, Boolean acceptChanges, Boolean modifyProperties, Nullable`1 forceStateWhenUnknownKey, Nullable`1 fallbackState)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.PaintAction(EntityEntryGraphNode`1 node)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityEntryGraphIterator.TraverseGraph[TState](EntityEntryGraphNode`1 node, Func`2 handleNode)\r\n   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.AttachGraph(InternalEntityEntry rootEntry, EntityState targetState, EntityState storeGeneratedWithKeySetTargetState, Boolean forceStateWhenUnknownKey)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SetEntityState(InternalEntityEntry entry, EntityState entityState)\r\n   at Microsoft.EntityFrameworkCore.DbContext.SetEntityState[TEntity](TEntity entity, EntityState entityState)\r\n   at Microsoft.EntityFrameworkCore.DbContext.Add[TEntity](TEntity entity)\r\n   at Microsoft.AspNetCore.Identity.EntityFrameworkCore.UserStore`9.CreateAsync(TUser user, CancellationToken cancellationToken)\r\n   at Microsoft.AspNetCore.Identity.UserManager`1.CreateAsync(TUser user)\r\n   at Kemet.ERP.Persistence.Repositories.Entity.HR.AccountRepository.ConfigureAndCreateUser(AppUser user, String password, CancellationToken cancellationToken) in C:\\Projects\\Web\\cyber-kemet-erp-api\\Kemet.ERP\\Kemet.ERP.Persistence\\Repositories\\Entity\\HR\\AccountRepository.cs:line 47\r\n   at Kemet.ERP.Persistence.Repositories.Entity.HR.AccountRepository.CreateUserAsync(AppUser user, String password, CancellationToken cancellationToken) in C:\\Projects\\Web\\cyber-kemet-erp-api\\Kemet.ERP\\Kemet.ERP.Persistence\\Repositories\\Entity\\HR\\AccountRepository.cs:line 20\r\n   at Kemet.ERP.Services.Entity.HR.AccountService.CreateUserAsync(CreateUserDto request, CancellationToken cancellationToken) in C:\\Projects\\Web\\cyber-kemet-erp-api\\Kemet.ERP\\Kemet.ERP.Services\\Entity\\HR\\AccountService.cs:line 22\r\n   at Kemet.ERP.Presentation.Controllers.HR.AccountsController.CreateUserAsync(CreateUserDto request, CancellationToken cancellationToken) in C:\\Projects\\Web\\cyber-kemet-erp-api\\Kemet.ERP\\Kemet.ERP.Presentation\\Controllers\\HR\\AccountsController.cs:line 21\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)\r\n   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Awaited|17_0(ResourceInvoker invoker, Task task, IDisposable scope)\r\n   at Kemet.ERP.Api.ManageExtensions.PiplineConfigurations.<>c.<<UseAppPipilines>b__0_0>d.MoveNext() in C:\\Projects\\Web\\cyber-kemet-erp-api\\Kemet.ERP\\Kemet.ERP.Api\\ManageExtensions\\PiplineConfigurations.cs:line 56\r\n--- End of stack trace from previous location ---\r\n   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)\r\n   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)\r\n   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)\r\n   at Kemet.ERP.Api.Middleware.RequestHandlingMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\\Projects\\Web\\cyber-kemet-erp-api\\Kemet.ERP\\Kemet.ERP.Api\\Middleware\\RequestHandlingMiddleware.cs:line 30\r\n   at Microsoft.AspNetCore.Builder.UseMiddlewareExtensions.InterfaceMiddlewareBinder.<>c__DisplayClass2_0.<<CreateMiddleware>b__0>d.MoveNext()\r\n--- End of stack trace from previous location ---\r\n   at Kemet.ERP.Api.Middleware.ExceptionHandlingMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\\Projects\\Web\\cyber-kemet-erp-api\\Kemet.ERP\\Kemet.ERP.Api\\Middleware\\ExceptionHandlingMiddleware.cs:line 14"}
